---
# tasks file for prometheus
- name: install prometheus
  unarchive:
   src: https://github.com/prometheus/prometheus/releases/download/v1.1.3/prometheus-1.1.3.linux-amd64.tar.gz
   dest: /Prometheus
   copy: no
   validate_certs: false

- name: install node-exporter
  unarchive:
   src: https://github.com/prometheus/node_exporter/releases/download/0.11.0/node_exporter-0.11.0.linux-amd64.tar.gz
   dest: /Node
   copy: no
   validate_certs: false

- name: create user prometheus
  shell: useradd --no-create-home --shell /bin/false node_exporter
  
- name: create user node_exporter
  shell: useradd --no-create-home --shell /bin/false node_exporter

- name: add node exporter init service
  copy:
   src: node_exporter.service
   dest: /etc/systemd/system/node_exporter.service

- name: config prometheus
  copy:
   src: prometheus.yml
   dest: /Prometheus/prometheus.yml

- name: add prometheus init service
  copy:
   src: prometheus.service
   dest: /etc/systemd/system/prometheus.service
  notify:
   - enable prometheus service on boot

- name: install alertmanager directory
  file:
   path: /Alertmanager
   state: directory

- name: install alertmanager
  unarchive:
   src: https://github.com/prometheus/alertmanager/releases/download/v0.13.0/alertmanager-0.13.0.linux-amd64.tar.gz
   dest: /Alertmanager
   copy: no
   validate_certs: false

- name: config alertmanager
  copy:
   src: alertmanager_config.yml
   dest: /Prometheus/alertmanager_config.yml

- name: add alertmanager init service
  copy:
   src: alertmanager.service
   dest: /etc/systemd/system/alertmanager.service
  notify:
   - enable alertmanager service on boot
